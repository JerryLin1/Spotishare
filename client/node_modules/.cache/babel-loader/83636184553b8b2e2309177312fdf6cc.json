{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Tiezh\\\\Desktop\\\\Spotishare\\\\client\\\\src\\\\Lobby.jsx\",\n    _s = $RefreshSig$();\n\nimport { useContext, useEffect, useRef, useState } from \"react\";\nimport { Row, Col, Container, Card, Form, Button } from \"react-bootstrap\";\nimport { CaretDownFill, CaretUpFill } from \"react-bootstrap-icons\";\nimport { useParams } from \"react-router-dom\";\nimport Client from \"./client.js\";\nimport WebPlayback from \"./WebPlayback.jsx\";\nimport Queue from \"./Queue.jsx\";\nimport { ClientContext } from \"./contexts/ClientProvider.jsx\";\nimport { isLoggedIn, login } from \".\";\nimport \"./css/Lobby.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Lobby(props) {\n  _s();\n\n  let {\n    roomId\n  } = useParams();\n  const client = useContext(ClientContext);\n  const [members, setMembers] = useState([]); //useState([{ isHost: true, name: 'Tom Han', id: 'p.han.tom', country: 'CA', image: 'https://i.scdn.co/image/ab6775700000ee8508f4b5251c39729ba880fb66' }]);\n\n  const [chat, setChat] = useState([]);\n  const [queue, updateQueue] = useState([\"3dPtXHP0oXQ4HCWHsOA9js?si=8593d745abde4cb7\", \"3dPtXHP0oXQ4HCWHsOA9js?si=8593d745abde4cb7\", \"185Wm4Mx09dQG0fUktklDm?si=8fd67a8eb5f04c99\", \"3dPtXHP0oXQ4HCWHsOA9js?si=8593d745abde4cb7\", \"185Wm4Mx09dQG0fUktklDm?si=8fd67a8eb5f04c99\", \"185Wm4Mx09dQG0fUktklDm?si=8fd67a8eb5f04c99\"]);\n  const [typingTimeout, updateTypingTimeout] = useState(undefined);\n  const [searchResults, setSearchResults] = useState([]);\n  const searchInputRef = useRef(null);\n\n  const renderMembers = () => {\n    let newMemberList = [];\n\n    for (const user of members) {\n      newMemberList.push( /*#__PURE__*/_jsxDEV(Row, {\n        className: \"member-card\",\n        children: [/*#__PURE__*/_jsxDEV(Col, {\n          id: \"member-name\",\n          children: [user.name, user.isHost && /*#__PURE__*/_jsxDEV(\"svg\", {\n            xmlns: \"http://www.w3.org/2000/svg\",\n            width: 36,\n            height: 20,\n            viewBox: \"0 0 512 512\",\n            fill: \"gold\",\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              d: \"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 42,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 41,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 38,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Col, {\n          style: {\n            display: \"flex\",\n            justifyContent: \"right\",\n            padding: \"0\"\n          },\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            id: \"pfp-container\",\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              id: \"member-pfp\",\n              src: user.image\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 48,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 47,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 46,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 37,\n        columnNumber: 17\n      }, this));\n    }\n\n    return newMemberList;\n  };\n\n  const initializeUser = () => {\n    fetch(`/joinLobby?roomId=${roomId}&accessToken=${localStorage.getItem(\"spotify-access-token\")}&socketid=${client.socket.id}`).then(data => {\n      if (data.status === 200) {\n        client.socket.emit(\"joinRoom\", {\n          roomId: roomId,\n          accessToken: localStorage.getItem(\"spotify-access-token\")\n        }, response => {\n          client.isHost = response.isHost;\n        });\n      }\n    });\n  };\n\n  const addToQueue = id => {\n    let newQueue = queue.slice();\n    queue.push(id);\n    newQueue.push(id);\n    updateQueue(newQueue);\n  };\n\n  useEffect(() => {\n    initializeUser();\n    client.socket.on(\"receiveMessage\", _ref => {\n      let {\n        msg,\n        type,\n        userName,\n        userId\n      } = _ref;\n      const chat = document.getElementById(\"chat\"); // console.log(chat.scrollTop + chat.clientHeight, chat.scrollHeight);\n\n      if (chat.scrollTop + chat.clientHeight >= chat.scrollHeight - 200) chat.scrollTop = chat.scrollHeight;\n      setChat(oldChat => [...oldChat, /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [type == \"USER\" && /*#__PURE__*/_jsxDEV(\"span\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: userName\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 93,\n            columnNumber: 29\n          }, this), \":\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 25\n        }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n          dangerouslySetInnerHTML: {\n            __html: processChatMessage(msg)\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 17\n      }, this)]);\n    });\n    client.socket.on(\"updateClientList\", clients => {\n      client.clientsInRoom = clients;\n      setMembers(Object.values(clients));\n    });\n  }, []);\n\n  const toggleLobbyList = () => {\n    if (document.getElementsByClassName(\"lobby-list\")[0].classList.contains(\"visible\")) {\n      document.getElementsByClassName(\"lobby-list\")[0].className = \"lobby-list\";\n      document.getElementById(\"caret\").style.transform = \"translateY(-50%) rotate(0deg)\";\n    } else {\n      document.getElementsByClassName(\"lobby-list\")[0].className = \"lobby-list visible\";\n      document.getElementById(\"caret\").style.transform = \"translateY(-50%) rotate(180deg)\";\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(Container, {\n    fluid: true,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"page-title unselectable\",\n      children: \"SpotiShare\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Row, {\n      children: [/*#__PURE__*/_jsxDEV(Col, {\n        xl: \"8\",\n        children: /*#__PURE__*/_jsxDEV(WebPlayback, {\n          roomId: roomId,\n          disabled: client.isHost,\n          token: localStorage.getItem(\"spotify-access-token\")\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Col, {\n        children: [/*#__PURE__*/_jsxDEV(Card, {\n          className: \"chat-container\",\n          children: [/*#__PURE__*/_jsxDEV(Card.Header, {\n            id: \"chat-header\",\n            className: \"unselectable\",\n            children: \"Chat\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 126,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"dropdown unselectable\",\n            onClick: toggleLobbyList,\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              style: {\n                margin: \"0\"\n              },\n              children: [\"Currently listening (\", members ? members.length : 0, \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 130,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(CaretDownFill, {\n              id: \"caret\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 131,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 129,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"lobby-list\",\n            children: renderMembers()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 133,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Card.Body, {\n            id: \"chat\",\n            children: chat\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Form, {\n          autoComplete: \"off\",\n          onSubmit: event => {\n            event.preventDefault();\n            client.sendMessage(document.getElementById(\"chatInput\").value);\n            document.getElementById(\"chatInput\").value = \"\";\n          },\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            id: \"sendBar\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              placeholder: \"Type a message...\",\n              type: \"text\",\n              id: \"chatInput\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 145,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"outline-dark\",\n              type: \"submit\",\n              id: \"sendBtn\",\n              children: \"Send Message\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 146,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Row, {\n      children: [/*#__PURE__*/_jsxDEV(Col, {\n        xs: \"6\",\n        xl: \"8\",\n        id: \"queue\",\n        children: /*#__PURE__*/_jsxDEV(Queue, {\n          queue: queue\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Col, {\n        id: \"search-conatiner\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"searchArea\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"unselectable\",\n            children: \"Find a Song!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 159,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            ref: searchInputRef,\n            onInput: () => {\n              clearTimeout(typingTimeout);\n              updateTypingTimeout(setTimeout(() => {\n                fetch(`/search?value=${searchInputRef.current.value}&accessToken=${localStorage.getItem(\"spotify-access-token\")}`).then(e => e.json()).then(data => {\n                  setSearchResults(data);\n                });\n              }, 500));\n            },\n            id: \"searchbox\",\n            type: \"text\",\n            placeholder: \"Artist, Song Name, Album...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 160,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            id: \"result-list\",\n            children: searchResults.map((item, key) => {\n              return /*#__PURE__*/_jsxDEV(Row, {\n                className: \"song-card\",\n                children: [/*#__PURE__*/_jsxDEV(Col, {\n                  xs: 10,\n                  children: /*#__PURE__*/_jsxDEV(\"iframe\", {\n                    src: `https://open.spotify.com/embed/track/${item.id}?utm_source=generator`,\n                    width: \"100%\",\n                    height: \"80\",\n                    frameBorder: \"0\",\n                    allowFullScreen: \"\",\n                    allow: \"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 187,\n                    columnNumber: 45\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 186,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(Col, {\n                  style: {\n                    display: \"flex\",\n                    alignItems: \"center\",\n                    padding: \"0\"\n                  },\n                  children: /*#__PURE__*/_jsxDEV(\"button\", {\n                    children: \"Add\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 197,\n                    columnNumber: 45\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 196,\n                  columnNumber: 41\n                }, this)]\n              }, key, true, {\n                fileName: _jsxFileName,\n                lineNumber: 185,\n                columnNumber: 37\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 118,\n    columnNumber: 9\n  }, this);\n} // modified from https://stackoverflow.com/a/8943487\n\n\n_s(Lobby, \"fDsjpmivdWQy/AP2+0PVtSFsl6A=\", false, function () {\n  return [useParams];\n});\n\n_c = Lobby;\n\nfunction processChatMessage(text) {\n  var urlRegex = /(\\b(https?|ftp|file):\\/\\/[-A-Z0-9+&@#\\/%?=~_|!:,.;]*[-A-Z0-9+&@#\\/%=~_|])/gi;\n  return text.replace(urlRegex, function (url) {\n    return `<a target=\"_blank\" href=\"${url}\"> ${url} </a>`;\n  });\n}\n\nexport default Lobby;\n\nvar _c;\n\n$RefreshReg$(_c, \"Lobby\");","map":{"version":3,"sources":["C:/Users/Tiezh/Desktop/Spotishare/client/src/Lobby.jsx"],"names":["useContext","useEffect","useRef","useState","Row","Col","Container","Card","Form","Button","CaretDownFill","CaretUpFill","useParams","Client","WebPlayback","Queue","ClientContext","isLoggedIn","login","Lobby","props","roomId","client","members","setMembers","chat","setChat","queue","updateQueue","typingTimeout","updateTypingTimeout","undefined","searchResults","setSearchResults","searchInputRef","renderMembers","newMemberList","user","push","name","isHost","display","justifyContent","padding","image","initializeUser","fetch","localStorage","getItem","socket","id","then","data","status","emit","accessToken","response","addToQueue","newQueue","slice","on","msg","type","userName","userId","document","getElementById","scrollTop","clientHeight","scrollHeight","oldChat","__html","processChatMessage","clients","clientsInRoom","Object","values","toggleLobbyList","getElementsByClassName","classList","contains","className","style","transform","margin","length","event","preventDefault","sendMessage","value","clearTimeout","setTimeout","current","e","json","map","item","key","alignItems","text","urlRegex","replace","url"],"mappings":"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","sourcesContent":["import { useContext, useEffect, useRef, useState } from \"react\";\nimport { Row, Col, Container, Card, Form, Button } from \"react-bootstrap\";\nimport { CaretDownFill, CaretUpFill } from \"react-bootstrap-icons\";\nimport { useParams } from \"react-router-dom\";\n\nimport Client from \"./client.js\";\nimport WebPlayback from \"./WebPlayback.jsx\";\nimport Queue from \"./Queue.jsx\";\nimport { ClientContext } from \"./contexts/ClientProvider.jsx\";\n\nimport { isLoggedIn, login } from \".\";\n\nimport \"./css/Lobby.css\";\n\nfunction Lobby(props) {\n    let { roomId } = useParams();\n    const client = useContext(ClientContext);\n    const [members, setMembers] = useState([]); //useState([{ isHost: true, name: 'Tom Han', id: 'p.han.tom', country: 'CA', image: 'https://i.scdn.co/image/ab6775700000ee8508f4b5251c39729ba880fb66' }]);\n    const [chat, setChat] = useState([]);\n    const [queue, updateQueue] = useState([\n        \"3dPtXHP0oXQ4HCWHsOA9js?si=8593d745abde4cb7\",\n        \"3dPtXHP0oXQ4HCWHsOA9js?si=8593d745abde4cb7\",\n        \"185Wm4Mx09dQG0fUktklDm?si=8fd67a8eb5f04c99\",\n        \"3dPtXHP0oXQ4HCWHsOA9js?si=8593d745abde4cb7\",\n        \"185Wm4Mx09dQG0fUktklDm?si=8fd67a8eb5f04c99\",\n        \"185Wm4Mx09dQG0fUktklDm?si=8fd67a8eb5f04c99\",\n    ]);\n    const [typingTimeout, updateTypingTimeout] = useState(undefined);\n    const [searchResults, setSearchResults] = useState([]);\n\n    const searchInputRef = useRef(null);\n\n    const renderMembers = () => {\n        let newMemberList = [];\n        for (const user of members) {\n            newMemberList.push(\n                <Row className=\"member-card\">\n                    <Col id=\"member-name\">\n                        {user.name}\n                        {user.isHost && (\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width={36} height={20} viewBox=\"0 0 512 512\" fill=\"gold\">\n                                <path d=\"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z\" />\n                            </svg>\n                        )}\n                    </Col>\n                    <Col style={{ display: \"flex\", justifyContent: \"right\", padding: \"0\" }}>\n                        <div id=\"pfp-container\">\n                            <img id=\"member-pfp\" src={user.image} />\n                        </div>\n                    </Col>\n                </Row>\n            );\n        }\n\n        return newMemberList;\n    };\n\n    const initializeUser = () => {\n        fetch(`/joinLobby?roomId=${roomId}&accessToken=${localStorage.getItem(\"spotify-access-token\")}&socketid=${client.socket.id}`).then((data) => {\n            if (data.status === 200) {\n                client.socket.emit(\n                    \"joinRoom\",\n                    { roomId: roomId, accessToken: localStorage.getItem(\"spotify-access-token\") },\n                    (response) => {\n                        client.isHost = response.isHost;\n                    }\n                );\n            }\n        });\n    };\n\n    const addToQueue = (id) => {\n        let newQueue = queue.slice();\n        queue.push(id);\n        newQueue.push(id);\n        updateQueue(newQueue);\n    };\n\n    useEffect(() => {\n        initializeUser();\n\n        client.socket.on(\"receiveMessage\", ({ msg, type, userName, userId }) => {\n            const chat = document.getElementById(\"chat\");\n\n            // console.log(chat.scrollTop + chat.clientHeight, chat.scrollHeight);\n            if (chat.scrollTop + chat.clientHeight >= chat.scrollHeight - 200) chat.scrollTop = chat.scrollHeight;\n\n            setChat((oldChat) => [\n                ...oldChat,\n                <div>\n                    {type == \"USER\" && (\n                        <span>\n                            <strong>{userName}</strong>:\n                        </span>\n                    )}{\" \"}\n                    <span dangerouslySetInnerHTML={{ __html: processChatMessage(msg) }} />\n                </div>,\n            ]);\n        });\n\n        client.socket.on(\"updateClientList\", (clients) => {\n            client.clientsInRoom = clients;\n            setMembers(Object.values(clients));\n        });\n    }, []);\n\n    const toggleLobbyList = () => {\n        if (document.getElementsByClassName(\"lobby-list\")[0].classList.contains(\"visible\")) {\n            document.getElementsByClassName(\"lobby-list\")[0].className = \"lobby-list\";\n            document.getElementById(\"caret\").style.transform = \"translateY(-50%) rotate(0deg)\";\n        } else {\n            document.getElementsByClassName(\"lobby-list\")[0].className = \"lobby-list visible\";\n            document.getElementById(\"caret\").style.transform = \"translateY(-50%) rotate(180deg)\";\n        }\n    };\n\n    return (\n        <Container fluid>\n            <div className=\"page-title unselectable\">SpotiShare</div>\n            <Row>\n                <Col xl=\"8\">\n                    <WebPlayback roomId={roomId} disabled={client.isHost} token={localStorage.getItem(\"spotify-access-token\")} />\n                </Col>\n                <Col>\n                    <Card className=\"chat-container\">\n                        <Card.Header id=\"chat-header\" className=\"unselectable\">\n                            Chat\n                        </Card.Header>\n                        <div className=\"dropdown unselectable\" onClick={toggleLobbyList}>\n                            <p style={{ margin: \"0\" }}>Currently listening ({members ? members.length : 0})</p>\n                            <CaretDownFill id=\"caret\" />\n                        </div>\n                        <div className=\"lobby-list\">{renderMembers()}</div>\n                        <Card.Body id=\"chat\">{chat}</Card.Body>\n                    </Card>\n                    <Form\n                        autoComplete=\"off\"\n                        onSubmit={(event) => {\n                            event.preventDefault();\n                            client.sendMessage(document.getElementById(\"chatInput\").value);\n                            document.getElementById(\"chatInput\").value = \"\";\n                        }}\n                    >\n                        <div id=\"sendBar\">\n                            <input placeholder=\"Type a message...\" type=\"text\" id=\"chatInput\" />\n                            <Button variant=\"outline-dark\" type=\"submit\" id=\"sendBtn\">\n                                Send Message\n                            </Button>\n                        </div>\n                    </Form>\n                </Col>\n            </Row>\n            <Row>\n                <Col xs=\"6\" xl=\"8\" id=\"queue\">\n                    <Queue queue={queue} />\n                </Col>\n                <Col id=\"search-conatiner\">\n                    <div id=\"searchArea\">\n                        <h3 className=\"unselectable\">Find a Song!</h3>\n                        <input\n                            ref={searchInputRef}\n                            onInput={() => {\n                                clearTimeout(typingTimeout);\n                                updateTypingTimeout(\n                                    setTimeout(() => {\n                                        fetch(\n                                            `/search?value=${searchInputRef.current.value}&accessToken=${localStorage.getItem(\n                                                \"spotify-access-token\"\n                                            )}`\n                                        )\n                                            .then((e) => e.json())\n                                            .then((data) => {\n                                                setSearchResults(data);\n                                            });\n                                    }, 500)\n                                );\n                            }}\n                            id=\"searchbox\"\n                            type=\"text\"\n                            placeholder=\"Artist, Song Name, Album...\"\n                        />\n                        <div id=\"result-list\">\n                            {searchResults.map((item, key) => {\n                                return (\n                                    <Row key={key} className=\"song-card\">\n                                        <Col xs={10}>\n                                            <iframe\n                                                src={`https://open.spotify.com/embed/track/${item.id}?utm_source=generator`}\n                                                width=\"100%\"\n                                                height=\"80\"\n                                                frameBorder=\"0\"\n                                                allowFullScreen=\"\"\n                                                allow=\"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture\"\n                                            ></iframe>\n                                        </Col>\n                                        <Col style={{ display: \"flex\", alignItems: \"center\", padding: \"0\" }}>\n                                            <button>Add</button>\n                                        </Col>\n                                    </Row>\n                                );\n                            })}\n                        </div>\n                    </div>\n                </Col>\n            </Row>\n        </Container>\n    );\n}\n\n// modified from https://stackoverflow.com/a/8943487\nfunction processChatMessage(text) {\n    var urlRegex = /(\\b(https?|ftp|file):\\/\\/[-A-Z0-9+&@#\\/%?=~_|!:,.;]*[-A-Z0-9+&@#\\/%=~_|])/gi;\n    return text.replace(urlRegex, function (url) {\n        return `<a target=\"_blank\" href=\"${url}\"> ${url} </a>`;\n    });\n}\n\nexport default Lobby;\n"]},"metadata":{},"sourceType":"module"}