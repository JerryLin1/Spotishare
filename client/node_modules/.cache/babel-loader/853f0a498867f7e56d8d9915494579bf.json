{"ast":null,"code":"import _toConsumableArray from\"C:\\\\Users\\\\Tiezh\\\\Desktop\\\\Spotishare\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\toConsumableArray.js\";import _createForOfIteratorHelper from\"C:\\\\Users\\\\Tiezh\\\\Desktop\\\\Spotishare\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\createForOfIteratorHelper.js\";import _slicedToArray from\"C:\\\\Users\\\\Tiezh\\\\Desktop\\\\Spotishare\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import{useContext,useEffect,useRef,useState}from\"react\";import{Row,Col,Container,Card,Form,Button}from\"react-bootstrap\";import{CaretDownFill,CaretUpFill}from\"react-bootstrap-icons\";import{useParams}from\"react-router-dom\";import Client from\"./client.js\";import WebPlayback from\"./WebPlayback.jsx\";import Queue from\"./Queue.jsx\";import{ClientContext}from\"./contexts/ClientProvider.jsx\";import{isLoggedIn,login}from\".\";import\"./css/Lobby.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Lobby(props){var _useParams=useParams(),roomId=_useParams.roomId;var client=useContext(ClientContext);var _useState=useState([]),_useState2=_slicedToArray(_useState,2),members=_useState2[0],setMembers=_useState2[1];//useState([{ isHost: true, name: 'Tom Han', id: 'p.han.tom', country: 'CA', image: 'https://i.scdn.co/image/ab6775700000ee8508f4b5251c39729ba880fb66' }]);\nvar _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),chat=_useState4[0],setChat=_useState4[1];var _useState5=useState([\"3dPtXHP0oXQ4HCWHsOA9js?si=8593d745abde4cb7\",\"3dPtXHP0oXQ4HCWHsOA9js?si=8593d745abde4cb7\",\"185Wm4Mx09dQG0fUktklDm?si=8fd67a8eb5f04c99\",\"3dPtXHP0oXQ4HCWHsOA9js?si=8593d745abde4cb7\",\"185Wm4Mx09dQG0fUktklDm?si=8fd67a8eb5f04c99\",\"185Wm4Mx09dQG0fUktklDm?si=8fd67a8eb5f04c99\"]),_useState6=_slicedToArray(_useState5,2),queue=_useState6[0],updateQueue=_useState6[1];var _useState7=useState(undefined),_useState8=_slicedToArray(_useState7,2),typingTimeout=_useState8[0],updateTypingTimeout=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),searchResults=_useState10[0],setSearchResults=_useState10[1];var searchInputRef=useRef(null);var renderMembers=function renderMembers(){var newMemberList=[];var _iterator=_createForOfIteratorHelper(members),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var user=_step.value;newMemberList.push(/*#__PURE__*/_jsxs(Row,{className:\"member-card\",children:[/*#__PURE__*/_jsxs(Col,{id:\"member-name\",children:[user.name,user.isHost&&/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",width:36,height:20,viewBox:\"0 0 512 512\",fill:\"gold\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z\"})})]}),/*#__PURE__*/_jsx(Col,{style:{display:\"flex\",justifyContent:\"right\",padding:\"0\"},children:/*#__PURE__*/_jsx(\"div\",{id:\"pfp-container\",children:/*#__PURE__*/_jsx(\"img\",{id:\"member-pfp\",src:user.image})})})]}));}}catch(err){_iterator.e(err);}finally{_iterator.f();}return newMemberList;};var initializeUser=function initializeUser(){fetch(\"/joinLobby?roomId=\".concat(roomId,\"&accessToken=\").concat(localStorage.getItem(\"spotify-access-token\"),\"&socketid=\").concat(client.socket.id)).then(function(data){if(data.status===200){client.socket.emit(\"joinRoom\",{roomId:roomId,accessToken:localStorage.getItem(\"spotify-access-token\")},function(response){client.isHost=response.isHost;});}});};var addToQueue=function addToQueue(id){var newQueue=queue.slice();queue.push(id);newQueue.push(id);updateQueue(newQueue);};useEffect(function(){initializeUser();client.socket.on(\"receiveMessage\",function(_ref){var msg=_ref.msg,type=_ref.type,userName=_ref.userName,userId=_ref.userId;var chat=document.getElementById(\"chat\");// console.log(chat.scrollTop + chat.clientHeight, chat.scrollHeight);\nif(chat.scrollTop+chat.clientHeight>=chat.scrollHeight-200)chat.scrollTop=chat.scrollHeight;setChat(function(oldChat){return[].concat(_toConsumableArray(oldChat),[/*#__PURE__*/_jsxs(\"div\",{children:[type==\"USER\"&&/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:userName}),\":\"]}),\" \",/*#__PURE__*/_jsx(\"span\",{dangerouslySetInnerHTML:{__html:processChatMessage(msg)}})]})]);});});client.socket.on(\"updateClientList\",function(clients){client.clientsInRoom=clients;setMembers(Object.values(clients));});},[]);var toggleLobbyList=function toggleLobbyList(){if(document.getElementsByClassName(\"lobby-list\")[0].classList.contains(\"visible\")){document.getElementsByClassName(\"lobby-list\")[0].className=\"lobby-list\";document.getElementById(\"caret\").style.transform=\"translateY(-50%) rotate(0deg)\";}else{document.getElementsByClassName(\"lobby-list\")[0].className=\"lobby-list visible\";document.getElementById(\"caret\").style.transform=\"translateY(-50%) rotate(180deg)\";}};return/*#__PURE__*/_jsxs(Container,{fluid:true,children:[/*#__PURE__*/_jsx(\"div\",{className:\"page-title unselectable\",children:\"SpotiShare\"}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{xl:\"8\",children:/*#__PURE__*/_jsx(WebPlayback,{roomId:roomId,disabled:client.isHost,token:localStorage.getItem(\"spotify-access-token\")})}),/*#__PURE__*/_jsxs(Col,{children:[/*#__PURE__*/_jsxs(Card,{className:\"chat-container\",children:[/*#__PURE__*/_jsx(Card.Header,{id:\"chat-header\",className:\"unselectable\",children:\"Chat\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"dropdown unselectable\",onClick:toggleLobbyList,children:[/*#__PURE__*/_jsxs(\"p\",{style:{margin:\"0\"},children:[\"Currently listening (\",members?members.length:0,\")\"]}),/*#__PURE__*/_jsx(CaretDownFill,{id:\"caret\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"lobby-list\",children:renderMembers()}),/*#__PURE__*/_jsx(Card.Body,{id:\"chat\",children:chat})]}),/*#__PURE__*/_jsx(Form,{autoComplete:\"off\",onSubmit:function onSubmit(event){event.preventDefault();client.sendMessage(document.getElementById(\"chatInput\").value);document.getElementById(\"chatInput\").value=\"\";},children:/*#__PURE__*/_jsxs(\"div\",{id:\"sendBar\",children:[/*#__PURE__*/_jsx(\"input\",{placeholder:\"Type a message...\",type:\"text\",id:\"chatInput\"}),/*#__PURE__*/_jsx(Button,{variant:\"outline-dark\",type:\"submit\",id:\"sendBtn\",children:\"Send Message\"})]})})]})]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{xs:\"6\",xl:\"8\",id:\"queue\",children:/*#__PURE__*/_jsx(Queue,{queue:queue})}),/*#__PURE__*/_jsx(Col,{id:\"search-conatiner\",children:/*#__PURE__*/_jsxs(\"div\",{id:\"searchArea\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"unselectable\",children:\"Find a Song!\"}),/*#__PURE__*/_jsx(\"input\",{ref:searchInputRef,onInput:function onInput(){clearTimeout(typingTimeout);updateTypingTimeout(setTimeout(function(){fetch(\"/search?value=\".concat(searchInputRef.current.value,\"&accessToken=\").concat(localStorage.getItem(\"spotify-access-token\"))).then(function(e){return e.json();}).then(function(data){setSearchResults(data);});},500));},id:\"searchbox\",type:\"text\",placeholder:\"Artist, Song Name, Album...\"}),/*#__PURE__*/_jsx(\"div\",{id:\"result-list\",children:searchResults.map(function(item,key){return/*#__PURE__*/_jsxs(Row,{className:\"song-card\",children:[/*#__PURE__*/_jsx(Col,{xs:10,children:/*#__PURE__*/_jsx(\"iframe\",{src:\"https://open.spotify.com/embed/track/\".concat(item.id,\"?utm_source=generator\"),width:\"100%\",height:\"80\",frameBorder:\"0\",allowFullScreen:\"\",allow:\"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture\"})}),/*#__PURE__*/_jsx(Col,{style:{display:\"flex\",alignItems:\"center\",padding:\"0\"},children:/*#__PURE__*/_jsx(\"button\",{children:\"Add\"})})]},key);})})]})})]})]});}// modified from https://stackoverflow.com/a/8943487\nfunction processChatMessage(text){var urlRegex=/(\\b(https?|ftp|file):\\/\\/[-A-Z0-9+&@#\\/%?=~_|!:,.;]*[-A-Z0-9+&@#\\/%=~_|])/gi;return text.replace(urlRegex,function(url){return\"<a target=\\\"_blank\\\" href=\\\"\".concat(url,\"\\\"> \").concat(url,\" </a>\");});}export default Lobby;","map":{"version":3,"sources":["C:/Users/Tiezh/Desktop/Spotishare/client/src/Lobby.jsx"],"names":["useContext","useEffect","useRef","useState","Row","Col","Container","Card","Form","Button","CaretDownFill","CaretUpFill","useParams","Client","WebPlayback","Queue","ClientContext","isLoggedIn","login","Lobby","props","roomId","client","members","setMembers","chat","setChat","queue","updateQueue","undefined","typingTimeout","updateTypingTimeout","searchResults","setSearchResults","searchInputRef","renderMembers","newMemberList","user","push","name","isHost","display","justifyContent","padding","image","initializeUser","fetch","localStorage","getItem","socket","id","then","data","status","emit","accessToken","response","addToQueue","newQueue","slice","on","msg","type","userName","userId","document","getElementById","scrollTop","clientHeight","scrollHeight","oldChat","__html","processChatMessage","clients","clientsInRoom","Object","values","toggleLobbyList","getElementsByClassName","classList","contains","className","style","transform","margin","length","event","preventDefault","sendMessage","value","clearTimeout","setTimeout","current","e","json","map","item","key","alignItems","text","urlRegex","replace","url"],"mappings":"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","sourcesContent":["import { useContext, useEffect, useRef, useState } from \"react\";\nimport { Row, Col, Container, Card, Form, Button } from \"react-bootstrap\";\nimport { CaretDownFill, CaretUpFill } from \"react-bootstrap-icons\";\nimport { useParams } from \"react-router-dom\";\n\nimport Client from \"./client.js\";\nimport WebPlayback from \"./WebPlayback.jsx\";\nimport Queue from \"./Queue.jsx\";\nimport { ClientContext } from \"./contexts/ClientProvider.jsx\";\n\nimport { isLoggedIn, login } from \".\";\n\nimport \"./css/Lobby.css\";\n\nfunction Lobby(props) {\n    let { roomId } = useParams();\n    const client = useContext(ClientContext);\n    const [members, setMembers] = useState([]); //useState([{ isHost: true, name: 'Tom Han', id: 'p.han.tom', country: 'CA', image: 'https://i.scdn.co/image/ab6775700000ee8508f4b5251c39729ba880fb66' }]);\n    const [chat, setChat] = useState([]);\n    const [queue, updateQueue] = useState([\n        \"3dPtXHP0oXQ4HCWHsOA9js?si=8593d745abde4cb7\",\n        \"3dPtXHP0oXQ4HCWHsOA9js?si=8593d745abde4cb7\",\n        \"185Wm4Mx09dQG0fUktklDm?si=8fd67a8eb5f04c99\",\n        \"3dPtXHP0oXQ4HCWHsOA9js?si=8593d745abde4cb7\",\n        \"185Wm4Mx09dQG0fUktklDm?si=8fd67a8eb5f04c99\",\n        \"185Wm4Mx09dQG0fUktklDm?si=8fd67a8eb5f04c99\",\n    ]);\n    const [typingTimeout, updateTypingTimeout] = useState(undefined);\n    const [searchResults, setSearchResults] = useState([]);\n\n    const searchInputRef = useRef(null);\n\n    const renderMembers = () => {\n        let newMemberList = [];\n        for (const user of members) {\n            newMemberList.push(\n                <Row className=\"member-card\">\n                    <Col id=\"member-name\">\n                        {user.name}\n                        {user.isHost && (\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width={36} height={20} viewBox=\"0 0 512 512\" fill=\"gold\">\n                                <path d=\"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z\" />\n                            </svg>\n                        )}\n                    </Col>\n                    <Col style={{ display: \"flex\", justifyContent: \"right\", padding: \"0\" }}>\n                        <div id=\"pfp-container\">\n                            <img id=\"member-pfp\" src={user.image} />\n                        </div>\n                    </Col>\n                </Row>\n            );\n        }\n\n        return newMemberList;\n    };\n\n    const initializeUser = () => {\n        fetch(`/joinLobby?roomId=${roomId}&accessToken=${localStorage.getItem(\"spotify-access-token\")}&socketid=${client.socket.id}`).then((data) => {\n            if (data.status === 200) {\n                client.socket.emit(\n                    \"joinRoom\",\n                    { roomId: roomId, accessToken: localStorage.getItem(\"spotify-access-token\") },\n                    (response) => {\n                        client.isHost = response.isHost;\n                    }\n                );\n            }\n        });\n    };\n\n    const addToQueue = (id) => {\n        let newQueue = queue.slice();\n        queue.push(id);\n        newQueue.push(id);\n        updateQueue(newQueue);\n    };\n\n    useEffect(() => {\n        initializeUser();\n\n        client.socket.on(\"receiveMessage\", ({ msg, type, userName, userId }) => {\n            const chat = document.getElementById(\"chat\");\n\n            // console.log(chat.scrollTop + chat.clientHeight, chat.scrollHeight);\n            if (chat.scrollTop + chat.clientHeight >= chat.scrollHeight - 200) chat.scrollTop = chat.scrollHeight;\n\n            setChat((oldChat) => [\n                ...oldChat,\n                <div>\n                    {type == \"USER\" && (\n                        <span>\n                            <strong>{userName}</strong>:\n                        </span>\n                    )}{\" \"}\n                    <span dangerouslySetInnerHTML={{ __html: processChatMessage(msg) }} />\n                </div>,\n            ]);\n        });\n\n        client.socket.on(\"updateClientList\", (clients) => {\n            client.clientsInRoom = clients;\n            setMembers(Object.values(clients));\n        });\n    }, []);\n\n    const toggleLobbyList = () => {\n        if (document.getElementsByClassName(\"lobby-list\")[0].classList.contains(\"visible\")) {\n            document.getElementsByClassName(\"lobby-list\")[0].className = \"lobby-list\";\n            document.getElementById(\"caret\").style.transform = \"translateY(-50%) rotate(0deg)\";\n        } else {\n            document.getElementsByClassName(\"lobby-list\")[0].className = \"lobby-list visible\";\n            document.getElementById(\"caret\").style.transform = \"translateY(-50%) rotate(180deg)\";\n        }\n    };\n\n    return (\n        <Container fluid>\n            <div className=\"page-title unselectable\">SpotiShare</div>\n            <Row>\n                <Col xl=\"8\">\n                    <WebPlayback roomId={roomId} disabled={client.isHost} token={localStorage.getItem(\"spotify-access-token\")} />\n                </Col>\n                <Col>\n                    <Card className=\"chat-container\">\n                        <Card.Header id=\"chat-header\" className=\"unselectable\">\n                            Chat\n                        </Card.Header>\n                        <div className=\"dropdown unselectable\" onClick={toggleLobbyList}>\n                            <p style={{ margin: \"0\" }}>Currently listening ({members ? members.length : 0})</p>\n                            <CaretDownFill id=\"caret\" />\n                        </div>\n                        <div className=\"lobby-list\">{renderMembers()}</div>\n                        <Card.Body id=\"chat\">{chat}</Card.Body>\n                    </Card>\n                    <Form\n                        autoComplete=\"off\"\n                        onSubmit={(event) => {\n                            event.preventDefault();\n                            client.sendMessage(document.getElementById(\"chatInput\").value);\n                            document.getElementById(\"chatInput\").value = \"\";\n                        }}\n                    >\n                        <div id=\"sendBar\">\n                            <input placeholder=\"Type a message...\" type=\"text\" id=\"chatInput\" />\n                            <Button variant=\"outline-dark\" type=\"submit\" id=\"sendBtn\">\n                                Send Message\n                            </Button>\n                        </div>\n                    </Form>\n                </Col>\n            </Row>\n            <Row>\n                <Col xs=\"6\" xl=\"8\" id=\"queue\">\n                    <Queue queue={queue} />\n                </Col>\n                <Col id=\"search-conatiner\">\n                    <div id=\"searchArea\">\n                        <h3 className=\"unselectable\">Find a Song!</h3>\n                        <input\n                            ref={searchInputRef}\n                            onInput={() => {\n                                clearTimeout(typingTimeout);\n                                updateTypingTimeout(\n                                    setTimeout(() => {\n                                        fetch(\n                                            `/search?value=${searchInputRef.current.value}&accessToken=${localStorage.getItem(\n                                                \"spotify-access-token\"\n                                            )}`\n                                        )\n                                            .then((e) => e.json())\n                                            .then((data) => {\n                                                setSearchResults(data);\n                                            });\n                                    }, 500)\n                                );\n                            }}\n                            id=\"searchbox\"\n                            type=\"text\"\n                            placeholder=\"Artist, Song Name, Album...\"\n                        />\n                        <div id=\"result-list\">\n                            {searchResults.map((item, key) => {\n                                return (\n                                    <Row key={key} className=\"song-card\">\n                                        <Col xs={10}>\n                                            <iframe\n                                                src={`https://open.spotify.com/embed/track/${item.id}?utm_source=generator`}\n                                                width=\"100%\"\n                                                height=\"80\"\n                                                frameBorder=\"0\"\n                                                allowFullScreen=\"\"\n                                                allow=\"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture\"\n                                            ></iframe>\n                                        </Col>\n                                        <Col style={{ display: \"flex\", alignItems: \"center\", padding: \"0\" }}>\n                                            <button>Add</button>\n                                        </Col>\n                                    </Row>\n                                );\n                            })}\n                        </div>\n                    </div>\n                </Col>\n            </Row>\n        </Container>\n    );\n}\n\n// modified from https://stackoverflow.com/a/8943487\nfunction processChatMessage(text) {\n    var urlRegex = /(\\b(https?|ftp|file):\\/\\/[-A-Z0-9+&@#\\/%?=~_|!:,.;]*[-A-Z0-9+&@#\\/%=~_|])/gi;\n    return text.replace(urlRegex, function (url) {\n        return `<a target=\"_blank\" href=\"${url}\"> ${url} </a>`;\n    });\n}\n\nexport default Lobby;\n"]},"metadata":{},"sourceType":"module"}